job_id: file_proj_clients
version: '2.0'
steps:
- step_id: render
  op: call
  params:
    callable: file_renderer
    sqlite_path: ~/clinical-vault/local.db
    query: >-
      SELECT client_folder, first_name, last_name, email, mobile, phone,
      client_type, created_at, idem_key, client_id
      FROM clients ORDER BY client_folder
    base_path: ~/clinical-vault/views
    path_template: '{client_folder}/contact.md'
    content_template: "# {first_name} {last_name}\n\n**Email:** {email}\n**Mobile:**\
      \ {mobile}\n**Phone:** {phone}\n**Type:** {client_type}\n**Created:** {created_at}"
    front_matter:
      source_type: contact
      entity: contacts
      record_id: '{client_id}'
      record_id_field: contactid
      projected_at: '{_projected_at}'
      idem_key: '{idem_key}'
- step_id: persist
  op: plan.build
  params:
    items: '@run.render.items'
    method: file.write
- step_id: write
  op: storacle.submit
  params:
    plan: '@run.persist.plan'
