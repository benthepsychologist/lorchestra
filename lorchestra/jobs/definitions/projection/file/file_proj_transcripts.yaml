job_id: file_proj_transcripts
version: '2.0'
steps:
- step_id: render
  op: call
  params:
    callable: file_renderer
    sqlite_path: ~/clinical-vault/local.db
    query: >-
      SELECT c.client_folder, s.session_num, t.content, t.idem_key,
      t.transcript_id, t.session_id, t.client_id
      FROM transcripts t
      JOIN sessions s ON t.session_id = s.session_id
      JOIN clients c ON t.client_id = c.client_id
      WHERE t.content IS NOT NULL
      ORDER BY c.client_folder, s.session_num
    base_path: ~/clinical-vault/views
    path_template: '{client_folder}/sessions/session-{session_num}/transcript.md'
    content_template: '{content}'
    front_matter:
      source_type: transcript
      entity: cre92_clientsessions
      record_id: '{session_id}'
      record_id_field: cre92_clientsessionid
      projected_at: '{_projected_at}'
      idem_key: '{idem_key}'
- step_id: persist
  op: plan.build
  params:
    items: '@run.render.items'
    method: file.write
- step_id: write
  op: storacle.submit
  params:
    plan: '@run.persist.plan'
