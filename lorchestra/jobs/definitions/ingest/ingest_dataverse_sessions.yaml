job_id: ingest_dataverse_sessions
version: '2.0'
steps:
- step_id: ingest
  op: call
  params:
    callable: injest
    source: dataverse_sessions
- step_id: persist
  op: plan.build
  params:
    items: '@run.ingest.items'
    method: bq.upsert
    dataset: raw
    table: raw_objects
    key_columns:
    - idem_key
    payload_wrap: true
    id_field: cre92_clientsessionid
    field_defaults:
      source_system: dataverse
      connection_name: dataverse-clinic
      object_type: session
- step_id: write
  op: storacle.submit
  params:
    plan: '@run.persist.plan'
