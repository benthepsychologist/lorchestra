aip_id: AIP-lorch-2025-11-14-001
context:
  background: The package is currently named "lorch" (Local Orchestrator) but we want to rename it to
    "lorchestra" for better branding and clarity.
  constraints:
  - Maintain all functionality - this is purely a rename
  - No logic changes
  - Preserve git history
  - Update .specwright files but keep historical AIPs as-is (for audit trail)
  - Root directory rename is optional (can stay `/home/user/lorch` if needed)
created: '2025-11-14T00:00:00+00:00'
meta:
  created_at: '2025-11-14T00:00:00+00:00'
  created_by: benthepsychologist
objective:
  acceptance_criteria:
  - 'Package directory renamed: `lorch/` â†’ `lorchestra/`'
  - 'All Python imports updated: `from lorch` â†’ `from lorchestra`'
  - 'CLI command renamed: `lorch` â†’ `lorchestra` in pyproject.toml'
  - Package metadata updated in pyproject.toml (name, console_scripts, include)
  - All 15 Python files updated with new imports
  - All 11 documentation files updated (README, CONTRIBUTING, docs/*)
  - All 3 configuration files updated
  - Build artifacts cleaned and package rebuilt
  - Package installs successfully as `lorchestra`
  - '`lorchestra --help` command works'
  - '`lorchestra validate` runs without import errors'
  - No references to old "lorch" name remain (except in git history/historical docs)
  - Changes committed with clear breaking change message
  - Changes pushed to remote
  goal: Systematically rename all references from "lorch" to "lorchestra" across entire codebase
orchestrator_contract:
  artifacts_dir: .aip_artifacts/AIP-lorch-2025-11-14-001
  logging: jsonl
  state_machine:
    events:
    - run_step
    - await_gate
    - approve
    - reject
    - retry
    - escalate
    - complete
    states:
    - pending
    - running
    - awaiting_human
    - failed
    - succeeded
    - rolled_back
plan:
- description: Rename Package Directory
  gate_ref: 'G0: Design Approval'
  kind: code
  outputs:
  - lorchestra/
  prompt: 'Rename the main Python package directory:

    ```bash

    cd /home/user/lorch

    mv lorch lorchestra

    ```

    Verify the directory structure:

    ```bash

    ls -la lorchestra/

    ls -la lorchestra/stages/

    ls -la lorchestra/tools/

    ```'
  role: coding_agent
  step_id: step-001
- description: Update Package Metadata
  gate_ref: 'G0: Design Approval'
  kind: code
  outputs:
  - pyproject.toml
  prompt: 'Update `pyproject.toml` to use new package name:

    **Changes needed:**

    - Line 2: `name = "lorch"` â†’ `name = "lorchestra"`

    - Line 4: Update description to mention "lorchestra" instead of "lorch"

    - Line 24: `lorch = "lorch.cli:main"` â†’ `lorchestra = "lorchestra.cli:main"`

    - Line 32: `include = ["lorch*"]` â†’ `include = ["lorchestra*"]`'
  role: coding_agent
  step_id: step-002
- description: Update Core Python Module Imports
  gate_ref: 'G1: Code Readiness'
  kind: code
  prompt: "Update the main package modules with new import paths:\n**Files to update:**\n1. **lorchestra/__init__.py:**\n\
    \   - Line 2: Docstring `\"\"\"lorch` â†’ `\"\"\"lorchestra`\n2. **lorchestra/cli.py:**\n   - Line 2:\
    \ Docstring `\"\"\"CLI interface for lorch` â†’ `\"\"\"CLI interface for lorchestra`\n   - Line 11:\
    \ `from lorch import __version__` â†’ `from lorchestra import __version__`\n   - Line 12: `from lorch.config`\
    \ â†’ `from lorchestra.config`\n   - Line 13: `from lorch.pipeline` â†’ `from lorchestra.pipeline`\n \
    \  - Line 14: `from lorch.utils` â†’ `from lorchestra.utils`\n   - Line 25: `prog_name=\"lorch\"` â†’\
    \ `prog_name=\"lorchestra\"`\n   - Line 28: Docstring `\"\"\"lorch - Local` â†’ `\"\"\"lorchestra -\
    \ Local`\n   - All docstrings: Replace command examples `lorch` â†’ `lorchestra` (80+ occurrences)\n\
    3. **lorchestra/config.py:**\n   - Line 2: Docstring `\"\"\"Configuration management for lorch` â†’\
    \ `\"\"\"Configuration management for lorchestra`\n4. **lorchestra/pipeline.py:**\n   - Line 2: Docstring\
    \ `\"\"\"Pipeline orchestrator for lorch` â†’ `\"\"\"Pipeline orchestrator for lorchestra`\n   - Line\
    \ 14: `from lorch.config` â†’ `from lorchestra.config`\n   - Line 15: `from lorch.stages.base` â†’ `from\
    \ lorchestra.stages.base`\n   - Line 16: `from lorch.stages.canonize` â†’ `from lorchestra.stages.canonize`\n\
    \   - Line 17: `from lorch.stages.extract` â†’ `from lorchestra.stages.extract`\n   - Line 18: `from\
    \ lorch.stages.index` â†’ `from lorchestra.stages.index`\n   - Line 19: `from lorch.utils` â†’ `from lorchestra.utils`\n\
    5. **lorchestra/utils.py:**\n   - Docstring updates"
  role: coding_agent
  step_id: step-003
- description: Update Stage Modules
  gate_ref: 'G1: Code Readiness'
  kind: code
  prompt: "Update all stage modules with new imports:\n**Files to update:**\n1. **lorchestra/stages/__init__.py:**\n\
    \   - Line 2: Docstring `\"\"\"Pipeline stages for lorch` â†’ `\"\"\"Pipeline stages for lorchestra`\n\
    2. **lorchestra/stages/base.py:**\n   - Line 14: `from lorch.config` â†’ `from lorchestra.config`\n\
    \   - Line 200: `.lorch_write_test` â†’ `.lorchestra_write_test`\n3. **lorchestra/stages/extract.py:**\n\
    \   - Line 11: `from lorch.config` â†’ `from lorchestra.config`\n   - Line 12: `from lorch.stages.base`\
    \ â†’ `from lorchestra.stages.base`\n   - Line 13: `from lorch.tools.meltano` â†’ `from lorchestra.tools.meltano`\n\
    \   - Line 14: `from lorch.utils` â†’ `from lorchestra.utils`\n4. **lorchestra/stages/canonize.py:**\n\
    \   - Line 9: `from lorch.config` â†’ `from lorchestra.config`\n   - Line 10: `from lorch.stages.base`\
    \ â†’ `from lorchestra.stages.base`\n   - Line 11: `from lorch.tools.canonizer` â†’ `from lorchestra.tools.canonizer`\n\
    5. **lorchestra/stages/index.py:**\n   - Line 10: `from lorch.config` â†’ `from lorchestra.config`\n\
    \   - Line 11: `from lorch.stages.base` â†’ `from lorchestra.stages.base`\n   - Line 12: `from lorch.tools.vector_projector`\
    \ â†’ `from lorchestra.tools.vector_projector`"
  role: coding_agent
  step_id: step-004
- description: Update Tool Adapter Modules
  gate_ref: 'G1: Code Readiness'
  kind: code
  prompt: "Update all tool adapter modules with new imports:\n**Files to update:**\n1. **lorchestra/tools/__init__.py:**\n\
    \   - Line 1: Docstring `\"\"\"Tool adapters for orchestrating external tools in lorch` â†’ `\"\"\"\
    in lorchestra`\n   - Line 3: `from lorch.tools.base` â†’ `from lorchestra.tools.base`\n   - Line 4:\
    \ `from lorch.tools.meltano` â†’ `from lorchestra.tools.meltano`\n2. **lorchestra/tools/base.py:**\n\
    \   - Docstring updates\n3. **lorchestra/tools/meltano.py:**\n   - Line 9: `from lorch.tools.base`\
    \ â†’ `from lorchestra.tools.base`\n4. **lorchestra/tools/canonizer.py:**\n   - Line 11: `from lorch.tools.base`\
    \ â†’ `from lorchestra.tools.base`\n5. **lorchestra/tools/vector_projector.py:**\n   - Line 9: `from\
    \ lorch.tools.base` â†’ `from lorchestra.tools.base`\n   - Line 10: `from lorch.utils` â†’ `from lorchestra.utils`"
  role: coding_agent
  step_id: step-005
- description: Update README.md
  gate_ref: 'G1: Code Readiness'
  kind: code
  outputs:
  - README.md
  prompt: 'Update `README.md` with 186 references to replace:

    **Pattern replacements:**

    - Title: `# lorch - Local Orchestrator` â†’ `# lorchestra - Local Orchestrator`

    - All command examples: `lorch` â†’ `lorchestra`

    - All descriptions: "lorch orchestrates" â†’ "lorchestra orchestrates"

    - Path references: `cd /home/user/lorch` â†’ `cd /home/user/lorchestra` (optional - can keep old path)

    - Directory structure: `lorch/` â†’ `lorchestra/`

    - Test commands: `pytest --cov=lorch` â†’ `pytest --cov=lorchestra`

    - Code formatting: `black lorch/` â†’ `black lorchestra/`

    - Linting: `ruff check lorch/` â†’ `ruff check lorchestra/`

    **Note:** Keep installation path flexible - can be either `/home/user/lorch` or `/home/user/lorchestra`'
  role: coding_agent
  step_id: step-006
- description: Update CONTRIBUTING.md
  gate_ref: 'G1: Code Readiness'
  kind: code
  outputs:
  - CONTRIBUTING.md
  prompt: 'Update `CONTRIBUTING.md` with 29 references:

    **Changes:**

    - Line 1: `# Contributing to lorch` â†’ `# Contributing to lorchestra`

    - Line 3: Thank you message

    - Line 34, 44: Path and command examples

    - Lines 54-55: Directory structure references

    - Lines 101-107: Code style command examples

    - Line 220: Import example: `from lorch.config` â†’ `from lorchestra.config`

    - Lines 253-503: All command examples

    - Line 516: Closing message'
  role: coding_agent
  step_id: step-007
- description: Update NEXT_STEPS.md
  gate_ref: 'G1: Code Readiness'
  kind: code
  outputs:
  - NEXT_STEPS.md
  prompt: 'Update `NEXT_STEPS.md` with 10 references:

    **Changes:**

    - Line 1: `# Next Steps for lorch Development` â†’ `lorchestra Development`

    - Line 3: Description of orchestrator

    - Command examples throughout

    - Path references: `lorch/stages/index.py` â†’ `lorchestra/stages/index.py`

    - Line 606: `Maintained By: lorch development team` â†’ `lorchestra development team`'
  role: coding_agent
  step_id: step-008
- description: Update Documentation Directory
  gate_ref: 'G1: Code Readiness'
  kind: code
  prompt: "Update all files in `docs/` directory:\n**Files and reference counts:**\n1. **docs/architecture.md**\
    \ (15 refs):\n   - Title, descriptions, ASCII diagrams\n   - Component mapping table\n   - Path references\n\
    2. **docs/configuration.md** (2 refs):\n   - Command examples\n3. **docs/cloud-migration.md** (9 refs):\n\
    \   - Pipeline translation descriptions\n   - Code/path references\n   - Commands\n4. **docs/transforms.md**\
    \ (2 refs):\n   - Pipeline description\n   - Command example\n5. **docs/whats_next.md** (4 refs):\n\
    \   - Title\n   - Descriptions\n   - Path references\n   - Commands\n6. **docs/vault.md** (12 refs):\n\
    \   - Descriptions\n   - Commands\n   - Code file path references in links\n7. **docs/time_based_extraction.md**\
    \ (27 refs):\n   - Title: `# Time-Based Extraction with lorch` â†’ `lorchestra`\n   - All command examples:\
    \ `lorch extract` â†’ `lorchestra extract`\n   - File path references\n8. **docs/gmail-config-fixes.md**\
    \ (7 refs):\n   - Command examples and descriptions"
  role: coding_agent
  step_id: step-009
- description: Update Configuration Files
  gate_ref: 'G1: Code Readiness'
  kind: code
  prompt: "Update configuration files:\n**Files:**\n1. **config/pipeline.yaml:**\n   - Line 1: `# lorch\
    \ Pipeline Configuration` â†’ `# lorchestra Pipeline Configuration`\n2. **.specwright.yaml:**\n   -\
    \ Line 11-12: Update paths if they reference \"lorch\" (keep historical references intact)\n3. **.specwright/aips/lorch-adapter-refactor.yaml:**\n\
    \   - Line 242: `project_slug: lorch` â†’ `project_slug: lorchestra`\n   - Path references (update if\
    \ needed, or keep for historical accuracy)\n   - Git URL: Note the repository name (will be updated\
    \ after GitHub rename)\n**Note:** Historical spec files can keep old references for audit trail purposes."
  role: coding_agent
  step_id: step-010
- description: Clean Build Artifacts
  gate_ref: 'G2: Pre-Release'
  kind: code
  prompt: 'Remove all build artifacts and old package metadata:

    ```bash

    cd /home/user/lorch

    rm -rf build/

    rm -rf dist/

    rm -rf lorch.egg-info/

    rm -rf lorchestra.egg-info/

    find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true

    ```

    Verify cleanup:

    ```bash

    ls -la | grep -E "build|dist|egg-info"

    ```

    **Validation:**

    - âœ“ No build/ directory

    - âœ“ No dist/ directory

    - âœ“ No egg-info directories

    - âœ“ Python cache cleaned'
  role: coding_agent
  step_id: step-011
- description: Reinstall Package
  gate_ref: 'G2: Pre-Release'
  kind: code
  outputs:
  - lorchestra
  prompt: 'Uninstall old package and install new one:

    ```bash

    cd /home/user/lorch

    pip uninstall lorch -y 2>/dev/null || echo "lorch not installed"

    pip install -e .

    ```

    Verify installation:

    ```bash

    pip list | grep lorchestra

    which lorchestra

    lorchestra --version

    ```

    **Validation:**

    - âœ“ Old "lorch" package uninstalled

    - âœ“ New "lorchestra" package installed

    - âœ“ `lorchestra` command available in PATH

    - âœ“ Version displays correctly'
  role: coding_agent
  step_id: step-012
- description: Test Basic Functionality
  gate_ref: 'G2: Pre-Release'
  kind: code
  prompt: 'Test that core commands work without import errors:

    ```bash

    # Test version

    lorchestra --version

    # Test help

    lorchestra --help

    # Test validation

    lorchestra validate

    # Test list commands

    lorchestra list extractors

    lorchestra list transforms

    # Test config commands

    lorchestra config show meltano

    # Test tools commands

    lorchestra tools list

    lorchestra tools validate meltano

    ```

    **Validation:**

    - âœ“ All commands execute without ImportError

    - âœ“ No references to "lorch" in command output

    - âœ“ Help text displays "lorchestra" correctly

    - âœ“ Configuration loads properly

    - âœ“ All adapters accessible'
  role: coding_agent
  step_id: step-013
- description: Verify No Lingering References
  gate_ref: 'G2: Pre-Release'
  kind: code
  prompt: 'Search for any remaining "lorch" references that should be updated:

    ```bash

    cd /home/user/lorch

    # Search Python files

    grep -r "from lorch" --include="*.py" lorchestra/ || echo "âœ“ No old imports found"

    grep -r "import lorch" --include="*.py" lorchestra/ || echo "âœ“ No old imports found"

    # Search documentation (excluding git history and this spec)

    grep -r "lorch " --include="*.md" --exclude-dir=.git --exclude="*adapter-refactor*" . | head -20

    # Check key files

    grep "prog_name" lorchestra/cli.py

    grep "name =" pyproject.toml | head -1

    ```

    **Expected:**

    - No `from lorch` imports in Python files

    - Only historical references in old specs (acceptable)

    - New package name in all active configuration'
  role: coding_agent
  step_id: step-014
- description: Commit Changes
  gate_ref: 'G3: Post-Implementation'
  kind: code
  prompt: 'Commit all changes with clear breaking change message:

    ```bash

    cd /home/user/lorch

    git add -A

    git status

    ```

    Create commit:

    ```bash

    git commit -m "$(cat <<''EOF''

    Rename package from lorch to lorchestra

    BREAKING CHANGE: Package name changed from ''lorch'' to ''lorchestra''

    This is a complete rename of the package for better branding and clarity.

    All functionality is preserved - only naming has changed.

    **Changes:**

    - Renamed package directory: lorch/ â†’ lorchestra/

    - Updated all Python imports: from lorch â†’ from lorchestra

    - Updated CLI command: lorch â†’ lorchestra

    - Updated package metadata in pyproject.toml

    - Updated all documentation files (11 files, 350+ references)

    - Updated configuration files

    - Cleaned and rebuilt package

    **Migration for users:**

    ```bash

    pip uninstall lorch

    pip install lorchestra  # or: pip install -e .

    ```

    **New usage:**

    ```bash

    lorchestra --help

    lorchestra extract <tap>

    lorchestra run --stage canonize

    ```

    All previous lorch commands now use lorchestra:

    - lorch â†’ lorchestra

    - from lorch.* â†’ from lorchestra.*

    ðŸ¤– Generated with Claude Code

    Co-Authored-By: Claude <noreply@anthropic.com>

    EOF

    )"

    ```

    **Validation:**

    - âœ“ All changed files staged

    - âœ“ Commit message includes BREAKING CHANGE tag

    - âœ“ Migration instructions provided'
  role: coding_agent
  step_id: step-015
- description: Push Changes
  gate_ref: 'G3: Post-Implementation'
  kind: code
  prompt: "Push changes to remote:\n```bash\ngit push origin main\n```\n**Optional:** If you want to rename\
    \ the GitHub repository:\n1. Go to https://github.com/benthepsychologist/lorch/settings\n2. Repository\
    \ name â†’ Change to \"lorchestra\"\n3. Confirm the rename\n4. Update local remote:\n   ```bash\n  \
    \ git remote set-url origin git@github.com:benthepsychologist/lorchestra.git\n   git remote -v\n \
    \  ```"
  role: coding_agent
  step_id: step-016
project_slug: lorch
repo:
  default_branch: main
  url: git@github.com:benthepsychologist/lorch.git
  working_branch: main
spec_version: 1.0.0
tier: C
title: Rename package from lorch to lorchestra
updated: '2025-11-14T12:31:30.596518+00:00'
version: '0.1'

